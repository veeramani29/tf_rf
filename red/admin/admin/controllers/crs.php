<?phperror_reporting(E_ALL);if (!defined('BASEPATH'))    exit('No direct script access allowed');class Crs extends CI_Controller {    public function __construct() {        parent::__construct();        $this->load->database();        $this->load->model('Cms_Model');        $this->load->model('Home_Model');        $this->load->model('Crs_Model');        $this->is_admin_logged_in();    }    private function is_admin_logged_in() {        if (!$this->session->userdata('admin_logged_in')) {            redirect('login/index');        }    }    public function index() {        redirect('home/dashboard');    }    public function coupons()    {        if($_POST)        {            $service = $this->input->post('service_type');            $code = $this->input->post('coupon_code');            $price = $this->input->post('price');                        if($service!='' && $code!='' && $price!='')            {                $this->Home_Model->addCouponCodeData($service,$code,$price);                redirect('crs/coupon_list');            }            else            {                $this->load->view('crs/coupons');            }        }        $this->load->view('crs/coupons');    }        function coupon_list()    {        $data['coupon_list'] = $this->Home_Model->getAllCouponList();        $this->load->view('crs/coupon_list',$data);    }        function edit_coupon($id)    {        if($_POST)        {            $service = $this->input->post('service_type');            $code = $this->input->post('coupon_code');            $price = $this->input->post('price');                        if($service!='' && $code!='' && $price!='')            {                $this->Home_Model->addCouponCodeData($service,$code,$price);                redirect('crs/coupon_list');            }            else            {                $data['coupon_data'] = $this->Home_Model->getCouponDataOnId($id);                $this->load->view('crs/edit_coupon',$data);            }        }        else        {            $data['coupon_data'] = $this->Home_Model->getCouponDataOnId($id);            $this->load->view('crs/edit_coupon',$data);        }    }        function coupon_action($id,$action)    {        $this->Home_Model->doCouponAction($id,$action);        redirect('crs/coupon_list');    }        function add_hotel($status='')    {                $data['status'] = $status;        $data['location'] = $this->Crs_Model->getAllCountryList();        $this->load->view('crs/add_hotel',$data);    }        function hotel_crs_list()    {        $data['hotels'] = $this->Crs_Model->getAllCrsHotels();        $this->load->view('crs/hotel_crs_list',$data);    }        function add_hotel_info()    {        //print_r($_POST);die;        $this->form_validation->set_rules('country', 'Country');        $this->form_validation->set_rules('city', 'City');        $this->form_validation->set_rules('hotel_name', 'Hotel Name');        $data['status']='';	$data['errors']='';                if($this->form_validation->run()==FALSE)        {            $data['location'] = $this->Crs_Model->getAllCountryList();            $data['country'] = $this->input->post('country');            $data['city'] = $this->input->post('city');            $data['hotel_name'] = $this->input->post('hotel_name');            $data['hotel_address'] = $this->input->post('hotel_address');            $data['hotel_contact'] = $this->input->post('hotel_contact');            $data['hotel_email'] = $this->input->post('hotel_email');            $data['hotel_latitude'] = $this->input->post('hotel_latitude');            $data['hotel_longitude'] = $this->input->post('hotel_longitude');            $data['on_sale'] = $this->input->post('on_sale');            $data['hotel_description'] = $this->input->post('hotel_description');            $data['star_rating'] = $this->input->post('star_rating');            $data['hotel_amenity'] = $this->input->post('hotel_amenity');            $data['hotel_what_we_know'] = $this->input->post('hotel_what_we_know');            $data['hotel_what_we_love'] = $this->input->post('hotel_what_we_love');            $data['status']='0';            $this->load->view('crs/add_hotel',$data);        }        else        {            $country = $this->input->post('country');            $city = $this->input->post('city');            $hotel_name = $this->input->post('hotel_name');            $hotel_address = $this->input->post('hotel_address');            $hotel_contact = $this->input->post('hotel_contact');            $hotel_email = $this->input->post('hotel_email');            $hotel_latitude = $this->input->post('hotel_latitude');            $hotel_longitude = $this->input->post('hotel_longitude');            $on_sale = $this->input->post('on_sale');            $hotel_description = $this->input->post('hotel_description');            $star_rating = $this->input->post('star_rating');            $hotel_amenity = $this->input->post('hotel_amenity');            $hotel_what_we_know = $this->input->post('hotel_what_we_know');            $hotel_what_we_love = $this->input->post('hotel_what_we_love');            $imagesArray = array();            $target = $_SERVER['DOCUMENT_ROOT']."/beta/uploads/";            //echo $target_dir;die;            //print_r($_FILES['file']['tmp_name']);die;            if(count($_FILES['file']['name']) > 0){                for($i=0; $i<count($_FILES['file']['name']); $i++) {                    $tmpFilePath = $_FILES['file']['tmp_name'][$i];                    if($tmpFilePath != ""){                        $shortname = date('YmdHis').$_FILES['file']['name'][$i];                        $filePath = $target.date('YmdHis').$_FILES['file']['name'][$i];                        if(move_uploaded_file($tmpFilePath, $filePath)) {                            $files[] = $shortname;                        }                      }                }            }                        //echo '<pre />';print_r($files);die;                        $insertArr = array('country'=>$country,                                'city'=>$city,                                'hotel_name'=>$hotel_name,                                'hotel_address'=>$hotel_address,                                'hotel_contact'=>$hotel_contact,                                'hotel_email'=>$hotel_email,                                'hotel_latitude'=>$hotel_latitude,                                'hotel_longitude'=>$hotel_longitude,                                'on_sale'=>$on_sale,                                'hotel_description'=>$hotel_description,                                'star_rating'=>$star_rating,                                'hotel_amenity'=>$hotel_amenity,                                'hotel_what_we_know'=>$hotel_what_we_know,                                'hotel_what_we_love'=>$hotel_what_we_love,                                'imagesArray'=>$files);                        $insert = $this->Crs_Model->addHotelData($insertArr);                        if($insert == 'true')            {                redirect('crs/add_hotel/1','refresh');            }            else            {                $data['errors'] = 'Hotel is not added. Please add the hotel again.';                $data['location'] = $this->Crs_Model->getAllCountryList();                $data['country'] = $this->input->post('country');                $data['city'] = $this->input->post('city');                $data['hotel_name'] = $this->input->post('hotel_name');                $data['hotel_address'] = $this->input->post('hotel_address');                $data['hotel_contact'] = $this->input->post('hotel_contact');                $data['hotel_email'] = $this->input->post('hotel_email');                $data['hotel_latitude'] = $this->input->post('hotel_latitude');                $data['hotel_longitude'] = $this->input->post('hotel_longitude');                $data['on_sale'] = $this->input->post('on_sale');                $data['hotel_description'] = $this->input->post('hotel_description');                $data['star_rating'] = $this->input->post('star_rating');                $data['hotel_amenity'] = $this->input->post('hotel_amenity');                $data['hotel_what_we_know'] = $this->input->post('hotel_what_we_know');                $data['hotel_what_we_love'] = $this->input->post('hotel_what_we_love');                $data['status']='0';                $this->load->view('crs/add_hotel',$data);            }        }     }        function getCityListOnCountry()    {        $country = $_POST['country'];        $city = $this->Crs_Model->getAllCityListOnCountry($country);                $html = '';        if($city !='')        {            $html .='<option value="">Select city</option>';            foreach($city as $list)            {                $html .='<option value="'.$list->City.'">'.$list->City.'</option>';            }        }        else        {            $html .='<option value="">No city available</option>';        }                echo json_encode(array('city_list'=>$html));    }        function manage_hotel_status()    {        $id = $_POST['user_id'];        $status = $_POST['status'];                if($id!='')        {            $this->Crs_Model->changeHotelStatus($id,$status);        }    }        function manage_hotel_room_status()    {        $id = $_POST['user_id'];        $status = $_POST['status'];                if($id!='')        {            $this->Crs_Model->changeHotelRoomStatus($id,$status);        }    }        function edit_hotel_crs_list($id,$status='')    {        $data['location'] = $this->Crs_Model->getAllCountryList();        $data['hotel_data'] = $this->Crs_Model->getHotelCrsDataOnId($id);        $data['hotel_images'] = $this->Crs_Model->getAllHotelImagesOnId($id);        //echo '<pre />';print_r($data['hotel_images']);die;        $data['hotel_id'] = $id;        $data['status'] = $status;        $this->load->view('crs/edit_hotel',$data);    }        function edit_hotel_info()    {        $this->form_validation->set_rules('country', 'Country');        $this->form_validation->set_rules('city', 'City');        $this->form_validation->set_rules('hotel_name', 'Hotel Name');        $data['status']='';	$data['errors']='';                if($this->form_validation->run()==FALSE)        {            $status='0';            $hotel_id = $this->input->post('hotel_id');            redirect('crs/edit_hotel_crs_list/'.$hotel_id.'/'.$status);        }        else        {            $hotel_id = $this->input->post('hotel_id');            $country = $this->input->post('country');            $city = $this->input->post('city');            $hotel_name = $this->input->post('hotel_name');            $hotel_address = $this->input->post('hotel_address');            $hotel_contact = $this->input->post('hotel_contact');            $hotel_email = $this->input->post('hotel_email');            $hotel_latitude = $this->input->post('hotel_latitude');            $hotel_longitude = $this->input->post('hotel_longitude');            $on_sale = $this->input->post('on_sale');            $hotel_description = $this->input->post('hotel_description');            $star_rating = $this->input->post('star_rating');            $hotel_amenity = $this->input->post('hotel_amenity');            $hotel_what_we_know = $this->input->post('hotel_what_we_know');            $hotel_what_we_love = $this->input->post('hotel_what_we_love');            //            $old_files = $this->input->post('old_file');//            print_r($old_files);die;            if(null !== $this->input->post('old_file'))            {                $old_files = $this->input->post('old_file');            }            else            {                $old_files = array();            }                                                $imagesArray = array();            $target = $_SERVER['DOCUMENT_ROOT']."/beta/uploads/";            $hotel_images = $this->Crs_Model->getAllHotelImagesOnId($hotel_id);            //chmod($target, 0777);            if($hotel_images!='')            {                foreach($hotel_images as $img)                {                    if(!in_array($img->image,$old_files))                    {                        if (file_exists($target.$img->image))                        {                            unlink($target.$img->image);                                                    }                    }                }            }                        if(count($_FILES['file']['name']) > 0){                for($i=0; $i<count($_FILES['file']['name']); $i++) {                    $tmpFilePath = $_FILES['file']['tmp_name'][$i];                    if($tmpFilePath != ""){                        $shortname = date('YmdHis').$_FILES['file']['name'][$i];                        $filePath = $target.date('YmdHis').$_FILES['file']['name'][$i];                        if(move_uploaded_file($tmpFilePath, $filePath)) {                            $files[] = $shortname;                        }                      }                }            }                        //echo '<pre />';print_r($files);die;                        if(!empty($old_files))            {                $allImages = array_merge(array_values($old_files), array_values($files));            }            else            {                $allImages = $files;            }                        //print_r($allImages);die;                        $insertArr = array('country'=>$country,                                'city'=>$city,                                'hotel_name'=>$hotel_name,                                'hotel_address'=>$hotel_address,                                'hotel_contact'=>$hotel_contact,                                'hotel_email'=>$hotel_email,                                'hotel_latitude'=>$hotel_latitude,                                'hotel_longitude'=>$hotel_longitude,                                'on_sale'=>$on_sale,                                'hotel_description'=>$hotel_description,                                'star_rating'=>$star_rating,                                'hotel_amenity'=>$hotel_amenity,                                'hotel_what_we_know'=>$hotel_what_we_know,                                'hotel_what_we_love'=>$hotel_what_we_love,                                'imagesArray'=>$allImages);                        $insert = $this->Crs_Model->editHotelData($insertArr,$hotel_id);                        if($insert == 'true')            {                redirect('crs/hotel_crs_list','refresh');            }            else            {                $status='0';                redirect('crs/edit_hotel_crs_list/'.$hotel_id.'/'.$status);            }        }    }        function hotel_room_list($id)    {        $data['hotel_id'] = $id;        $data['rooms'] = $this->Crs_Model->getHotelRoomsOnHotelId($id);                $this->load->view('crs/hotel_room_list',$data);    }        function add_rooms($id,$status='')    {        $data['hotel_id'] = $id;        $data['status'] = $status;        $this->load->view('crs/add_rooms',$data);    }        function add_hotel_room_info($id)    {        $this->form_validation->set_rules('room_type', 'Room Type','required');        $this->form_validation->set_rules('room_inclusion', 'Room Inclusion','required');        $this->form_validation->set_rules('room_price', 'Room Price','required');        $this->form_validation->set_rules('from_date', 'Date From','required');        $this->form_validation->set_rules('date_to', 'Date To','required');        $this->form_validation->set_rules('no_of_rooms', 'No Of Rooms','required');        $this->form_validation->set_rules('pax_count', 'Pax Count','required');        $data['status']='';	$data['errors']='';                if($this->form_validation->run()==FALSE)        {                        $data['room_type'] = $this->input->post('room_type');            $data['room_desc'] = $this->input->post('room_desc');            $data['room_inclusion'] = $this->input->post('room_inclusion');            $data['room_price'] = $this->input->post('room_price');            $data['from_date'] = $this->input->post('from_date');            $data['date_to'] = $this->input->post('date_to');            $data['no_of_rooms'] = $this->input->post('no_of_rooms');            $data['pax_count'] = $this->input->post('pax_count');                        $data['status']='0';            $this->load->view('crs/add_rooms/'.$id,$data);        }        else        {            $room_type = $this->input->post('room_type');            $room_desc = $this->input->post('room_desc');            $room_inclusion = $this->input->post('room_inclusion');            $room_price = $this->input->post('room_price');            $from_date = $this->input->post('from_date');            $date_to = $this->input->post('date_to');            $no_of_rooms = $this->input->post('no_of_rooms');            $pax_count = $this->input->post('pax_count');                        $imagesArray = array();            $target = $_SERVER['DOCUMENT_ROOT']."/beta/uploads/";            //echo $target_dir;die;                        for ($i = 0; $i < count($_FILES['file']['name']); $i++)             {                // Loop to get individual element from the array                $validextensions = array("jpeg", "jpg", "png");      // Extensions which are allowed.                $ext = explode('.', basename($_FILES['file']['name'][$i]));   // Explode file name from dot(.)                $file_extension = end($ext); // Store extensions in the variable.                $fileName = md5(date('YmdHis')).'.'.$file_extension;                $target_path = $target . md5(date('YmdHis')).'.'.$file_extension ;                  //echo $target_path;die;// Set the target path with a new name of image.                //$j = $j + 1;      // Increment the number of uploaded images according to the files in array.                if (move_uploaded_file($_FILES['file']['tmp_name'][$i], $target_path))                {                    $imagesArray[] = $fileName;                }                            }                                    $insertArr = array('room_type'=>$room_type,                                'room_desc'=>$room_desc,                                'room_inclusion'=>$room_inclusion,                                'room_price'=>$room_price,                                'from_date'=>$from_date,                                'date_to'=>$date_to,                                'no_of_rooms'=>$no_of_rooms,                                'pax_count'=>$pax_count,                                'imagesArray'=>$imagesArray,'hotel_id'=>$id);                        $insert = $this->Crs_Model->addHotelRoomData($insertArr);                        if($insert == 'true')            {                redirect('crs/add_rooms/'.$id.'/1','refresh');            }            else            {                $data['errors'] = 'Room is not added. Please add the hotel again.';                $data['room_type'] = $this->input->post('room_type');                $data['room_desc'] = $this->input->post('room_desc');                $data['room_inclusion'] = $this->input->post('room_inclusion');                $data['room_price'] = $this->input->post('room_price');                $data['from_date'] = $this->input->post('from_date');                $data['date_to'] = $this->input->post('date_to');                $data['no_of_rooms'] = $this->input->post('no_of_rooms');                $data['pax_count'] = $this->input->post('pax_count');                               $data['status']='0';                $this->load->view('crs/add_rooms/'.$id,$data);            }        }    }        function edit_hotel_crs_room_list($id,$status='')    {        $data['status'] = $status;        $data['room_data'] = $this->Crs_Model->getRoomDataOnId($id);        $data['hotel_id'] = $data['room_data']->hotel_id;        $this->load->view('crs/edit_room_data',$data);    }        function edit_room_info($id)    {        $this->form_validation->set_rules('room_type', 'Room Type','required');        $this->form_validation->set_rules('room_inclusion', 'Room Inclusion','required');        $this->form_validation->set_rules('room_price', 'Room Price','required');        $this->form_validation->set_rules('from_date', 'Date From','required');        $this->form_validation->set_rules('date_to', 'Date To','required');        $this->form_validation->set_rules('no_of_rooms', 'No Of Rooms','required');        $this->form_validation->set_rules('pax_count', 'Pax Count','required');        $data['status']='';	$data['errors']='';                $hotel_id = $this->input->post('hotel_id');        if($this->form_validation->run()==FALSE)        {            redirect('crs/edit_hotel_crs_room_list/'.$id.'/0','refresh');        }        else        {            $room_type = $this->input->post('room_type');            $room_inclusion = $this->input->post('room_inclusion');            $room_desc = $this->input->post('room_desc');            $room_price = $this->input->post('room_price');            $from_date = $this->input->post('from_date');            $date_to = $this->input->post('date_to');            $no_of_rooms = $this->input->post('no_of_rooms');            $pax_count = $this->input->post('pax_count');                        if(null !== $this->input->post('old_file'))            {                $old_files = $this->input->post('old_file');            }            else            {                $old_files = '';            }                        $imagesArray = array();            $target = $_SERVER['DOCUMENT_ROOT']."/beta/uploads/";            //echo $target_dir;die;            //print_r($_FILES['file']['name']);die;            if($_FILES['file']['name'][0] != '')            {            for ($i = 0; $i < count($_FILES['file']['name']); $i++)             {                // Loop to get individual element from the array                $validextensions = array("jpeg", "jpg", "png");      // Extensions which are allowed.                $ext = explode('.', basename($_FILES['file']['name'][$i]));   // Explode file name from dot(.)                $file_extension = end($ext); // Store extensions in the variable.                $fileName = md5(date('YmdHis')).'.'.$file_extension;                $target_path = $target . md5(date('YmdHis')).'.'.$file_extension ;                  //echo $target_path;die;// Set the target path with a new name of image.                //$j = $j + 1;      // Increment the number of uploaded images according to the files in array.                if (move_uploaded_file($_FILES['file']['tmp_name'][$i], $target_path))                {                    $imagesArray[] = $fileName;                }                            }            }            else            {                $imagesArray[] = $old_files;            }                                    $insertArr = array('room_type'=>$room_type,                                'room_inclusion'=>$room_inclusion,                                'room_price'=>$room_price,                                'from_date'=>$from_date,                                'date_to'=>$date_to,                                'no_of_rooms'=>$no_of_rooms,                                'pax_count'=>$pax_count,                                'imagesArray'=>$imagesArray,'room_id'=>$id);                        $insert = $this->Crs_Model->editHotelRoomData($insertArr);                        if($insert == 'true')            {                redirect('crs/hotel_room_list/'.$hotel_id.'/1','refresh');            }            else            {                redirect('crs/edit_hotel_crs_room_list/'.$id.'/0','refresh');            }        }    }        function cancel_policy($id)    {        $data['id'] = $id;        $data['result'] = $this->Crs_Model->getHotelCancelPolicy($id);        if($_POST)        {            $cancelPolicy = $this->input->post('content');            $this->db->query($sql="update hotel_crs set cancel_policy='".$cancelPolicy."' where id='".$id."'");            redirect('crs/hotel_crs_list','refresh');        }        else        {            $this->load->view('crs/update_cancel_policy',$data);        }    }}/* End of file welcome.php *//* Location: ./application/controllers/welcome.php */